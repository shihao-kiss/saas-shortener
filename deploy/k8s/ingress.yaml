# Kubernetes Ingress（入口）
# Ingress 是集群对外暴露 HTTP/HTTPS 服务的统一入口
# 它工作在 L7（应用层），支持：
# - 基于域名的路由
# - TLS 终止（HTTPS）
# - 路径重写
# - 负载均衡
#
# 需要安装 Ingress Controller（如 Nginx Ingress Controller）
# 安装命令：kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.0/deploy/static/provider/cloud/deploy.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: saas-shortener-ingress
  namespace: saas-shortener
  labels:
    app: saas-shortener
  annotations:
    # Nginx Ingress Controller 注解
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    # 限流注解（Ingress 层面的额外限流保护）
    nginx.ingress.kubernetes.io/limit-rps: "50"
    nginx.ingress.kubernetes.io/limit-burst-multiplier: "5"
    # CORS 跨域配置
    nginx.ingress.kubernetes.io/enable-cors: "true"
spec:
  ingressClassName: nginx
  rules:
    - host: shortener.example.com  # 替换为你的域名
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: saas-shortener-service
                port:
                  number: 80
  # TLS 配置（HTTPS）
  # 生产环境请配置 cert-manager 自动管理 Let's Encrypt 证书
  # tls:
  #   - hosts:
  #       - shortener.example.com
  #     secretName: shortener-tls
